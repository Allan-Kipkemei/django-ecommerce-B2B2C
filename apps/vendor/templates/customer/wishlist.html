{% extends 'core/base.html' %}
{% load static %}
{% load bootstrap4 %}
{% block title %} {{ request.session.username }}'s wishlist  - {% endblock %}
{% block content %}
{% include 'messages.html' %}

<script>
    function add_To_Cart(pr_id) {
         event.preventDefault(); //so that we stop normal form submit.
         var_id = $("#variant_id").val();
         pq = $("#quantity").val()
         $.ajax({
            url: "/order/addtoshopcart/" + pr_id,
            type: 'POST',
            data: {'variantid': var_id,
                'quantity':pq
            },
            success: function (data) {
                console.log(data);
                $("#my_cart").load(location.href + " #my_cart");
                $("#msg1").append(
                    '<div class="alert alert-success hideit alertSuc">added in cart successfully.</div >')
                setTimeout(function () {
                    $("#msg1").load(location.href + " #msg1");
                }, 1000);
            }
        });
    }


</script>

<div id="breadcrumb">
    <div class="container">
        <ul class="breadcrumb">
            <li><a href="/">Home</a></li>
            <li class="active">wishlist</li>
        </ul>
    </div>
</div>
<table class="table is-fullwidth">
        <tr>
            <th>Image</th>
            <th>Product</th>
            <th>Stock Status</th>
            <th>Price</th>
            <th></th>
        </tr>
        {% for product in wishlist %} 
        <tbody>
            <tr>
                <td>
                     {% if product.variant %} 
                     <img style="width: 70px;height: 70px;" src="{{product.variant.image_variant.url}}" alt="">
                     {% else %} 
                     <img style="width: 70px;height: 70px;" src="{{product.product.image.url}}" alt="">
                     {% endif %} 
                </td>
                <td>
                    {% if product.variant %} 
                         <a href="#">{{product.variant.title}}</a></br>
                         {% if product.variant.product.countreview %}
                         <div class="product-rating">
                             <i class="fa fa-star{% if product.avaregeview < 1%}-o empty{% endif%}"></i>
                             <i class="fa fa-star{% if product.avaregeview < 2%}-o empty{% endif%}"></i>
                             <i class="fa fa-star{% if product.avaregeview < 3%}-o empty{% endif%}"></i>
                             <i class="fa fa-star{% if product.avaregeview < 4%}-o empty{% endif%}"></i>
                             <i class="fa fa-star{% if product.avaregeview < 5%}-o empty{% endif%}"></i>
                             {{ product.avaregeview |stringformat:".2f"}}
                         </div>
                              {{product.variant.product.countreview}} review(s)
                         {% else %} 
                             -
                         {% endif %}
                    {% else %} 
                          <a href="#">{{product.product.title}}</a></br>
                          {% if product.product.countreview %}
                          <div class="product-rating">
                              <i class="fa fa-star{% if product.avaregeview < 1%}-o empty{% endif%}"></i>
                              <i class="fa fa-star{% if product.avaregeview < 2%}-o empty{% endif%}"></i>
                              <i class="fa fa-star{% if product.avaregeview < 3%}-o empty{% endif%}"></i>
                              <i class="fa fa-star{% if product.avaregeview < 4%}-o empty{% endif%}"></i>
                              <i class="fa fa-star{% if product.avaregeview < 5%}-o empty{% endif%}"></i></br>
                              {{ product.product.avaregeview |stringformat:".2f"}} / 5 Rate
                          </div>
                               {{product.product.countreview}} review(s)
                          {% else %} 
                              -
                          {% endif %}
                    {% endif %}
                </td>
                <td>
                    {% if product.variant %} 
                    {% if product.variant.quantity > 0 %} 
                      In Stock
                    {% else %} 
                    Out of Stock
                    {% endif %} 
                    {% else %} 
                    {% if product.product.quantity > 0 %} 
                      In Stock
                    {% else %} 
                    Out of Stock
                    {% endif %} 
                    {% endif %} 
                </td>
                <td>
                    {% if product.variant %} 
                    {% if product.variant.discount %} 
                      {{product.variant.get_discounted_price}}
                    {% else %} 
                     {{product.variant.price}}
                    {% endif %}
                    {% else %} 
                    {% if product.product.discount %} 
                      {{product.product.get_discounted_price}}
                    {% else %} 
                     {{product.product.price}}
                    {% endif %}
                    {% endif %}   
                </td>
                <div id="msg1" class="mt-3">
                <td>
                    {% if product.variant %} 
                       <input type="hidden" name="variantid" id="variant_id" value="{{ product.variant.id }}">
                        <input class="input" id="quantity" name="quantity" type="hidden" value="1" min="1" max="{{ product.variant.quantity }}">
                        <button class="button is-dark" onclick="add_To_Cart('{{ product.variant.id }}')" {% if product.variant.quantity < 1  %} disabled {% endif %} name="id" value="{{ product.variant.id }}">
                            <i class="fa fa-shopping-cart"></i> 
                         Add Cart</button>
                         
                     {% else %} 
                     <input class="input" name="quantity" id="quantity" type="hidden" value="1" min="1" max="{{ product.product.quantity }}">
                        <button onclick="add_To_Cart('{{ product.product.id }}')"  {% if product.product.quantity < 1  %} disabled {% endif %}  class="button is-dark"> 
                            <i class="fa fa-shopping-cart"></i> 
                         Add Cart</button>
                        </div>
                     {% endif %}
                    </div>
                </td>
                <td>
                    {% if product.variant %} 
                      <a href="/wishlist/delete/{{ product.variant.id }}" onclick="return confirm('Delete ! Are you sure?')"   class="main-btn icon-btn"><i class="fa fa-close"></i></a>
                    {% else %} 
                       <a href="/wishlist/delete/{{ product.product.id }}" onclick="return confirm('Delete ! Are you sure?')"  class="main-btn icon-btn"><i class="fa fa-close"></i></a>
                    {% endif %}
                </td>
            </tr>
        </tbody>
        {% endfor %}
</table>        
{% endblock %}
